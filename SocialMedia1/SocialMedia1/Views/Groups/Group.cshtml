@using Microsoft.AspNetCore.Identity
@using SocialMedia1.Services
@using System.Security.Claims

@model SocialMedia1.Models.GroupViewModel

@inject IGroupService groupService
@inject UserManager<IdentityUser> userManager
@inject SignInManager<IdentityUser> SignInManager



@{
    ViewData["Title"] = "Group";
}

<h1>Group</h1>

<div>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Name)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Name)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Description)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Description)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Creator)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Creator)
        </dd>
        <dd class="col-sm-10">
            <a href="/Groups/Members/@Model.Id" class="btn btn-outline-success">Members: @Model.Members</a>
        </dd>
    </dl>
</div>

@if (groupService.IsUserGroupMember(@User.FindFirstValue(ClaimTypes.NameIdentifier), Model.Id) == false)
{
    @if (groupService.IsJoinRequstSent(Model.Id, @User.FindFirstValue(ClaimTypes.NameIdentifier)))
    {
        <button type="button" class="btn-dark" disabled>Request Sent</button>
    }
    else
    {
        <a href="/Groups/JoinGroup/@Model.Id" class="btn-success btn">Join Group</a>
    }
}
else
{
    if (groupService.IsUserGroupCreator(@User.FindFirstValue(ClaimTypes.NameIdentifier), @Model.Id))
    {
        <a href="/Groups/JoinRequests/@Model.Id" class="btn-success btn">Join Requests: @Model.JoinRequests</a>
    }
    else
    {
        <a href="/Groups/LeaveGroup/@Model.Id" class="btn-danger btn">Leave Group</a>
    }

    <div>
        <form method="post" asp-action="CreatePost">
            <label for="content">Content:</label><br />
            <input type="text" id="content" name="content">
            <input type="hidden" id="id" name="id" value="@Model.Id" />
            <input type="submit" value="Submit">
        </form>
    </div>

    <hr />

    <div class="col-md-9">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>
                        Author
                    </th>
                    <th>
                        Content
                    </th>
                    <th>
                        Created On
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Posts)
                {
                    <tr onclick="window.location='/UserProfiles/Profile/@item.AuthorId';">
                        <td>
                            @Html.DisplayFor(modelItem => item.Author)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Content)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CreatedOn)
                        </td>
                    </tr>
                }
        </table>
    </div>
}

